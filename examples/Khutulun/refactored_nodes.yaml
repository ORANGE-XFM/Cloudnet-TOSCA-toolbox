tosca_definitions_version: tosca_2_0

description: Refactoring of https://raw.githubusercontent.com/tliron/khutulun/main/assets/tosca/profiles/khutulun/nodes.yaml

imports:

- https://raw.githubusercontent.com/tliron/khutulun/main/assets/tosca/profiles/khutulun/capabilities.yaml
- https://raw.githubusercontent.com/tliron/khutulun/main/assets/tosca/profiles/khutulun/relationships.yaml
- https://raw.githubusercontent.com/tliron/khutulun/main/assets/tosca/profiles/khutulun/interfaces.yaml

node_types:

  Root:
    interfaces:
      events:
        type: Events

  Redundant:
    derived_from: Root
    properties:
      count:
        type: Count
        default: 1
    requirements:
    - connection:
        capability: Connectible
        relationship: Connection
    - storage:
        capability: Storage
        relationship: Storage

  # Runnable

  ExposableRedundant:
    derived_from: Redundant
    capabilities:
      connectible: Exposable

  Process:
    derived_from: ExposableRedundant
    capabilities:
      runnable:
        type: Process

  Container:
    derived_from: ExposableRedundant
    capabilities:
      runnable: Container

  PristineContainer:
    derived_from: Container
    capabilities:
      runnable: PristineContainer

  SystemContainer:
    derived_from: Container
    capabilities:
      runnable: SystemContainer

  LoadBalancer:
    derived_from: Container
    capabilities:
      runnable:
        properties:
          image:
            default:
              reference: docker.io/nginx:1.21.6
    # TODO: attach an artifact that sets up loadbalancing

  VirtualMachine:
    derived_from: Redundant
    capabilities:
      runnable: VirtualMachine
      connectible: Connectible

  # Storage

  LocalDirectory:
    derived_from: Root
    capabilities:
      storage: LocalDirectory
